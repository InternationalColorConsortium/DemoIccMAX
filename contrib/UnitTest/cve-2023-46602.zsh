#!/bin/zsh

# Banner
echo "###############################################################"
echo "# Unit Test: Convert ICC to XML - CVE-2023-46602"
echo "# Description: Test the conversion of an ICC file to XML."
echo "###############################################################"

# Variables
SCRIPT_DIR="$(dirname "$0")"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/../../.." && pwd)"
BUILD_TOOLS_DIR="$PROJECT_ROOT/Build/Tools/IccToXml"
ICC_FILE="$PROJECT_ROOT/contrib/UnitTests/cve-2023-46602/cve-2023-46602.icc"
XML_OUTPUT="$PROJECT_ROOT/contrib/UnitTests/cve-2023-46602/cve-2023-46602.xml"
EXPECTED_OUTPUT="XML successfully created"

# Run the iccToXml command and capture output
OUTPUT=$("$BUILD_TOOLS_DIR/iccToXml" "$ICC_FILE" "$XML_OUTPUT" 2>&1)

# Test if the command output matches the expected result
if echo "$OUTPUT" | grep -q "$EXPECTED_OUTPUT"; then
    echo "Test Result: PASS - $EXPECTED_OUTPUT"
else
    echo "Test Result: FAIL"
    echo "Output:"
    echo "$OUTPUT"
fi
